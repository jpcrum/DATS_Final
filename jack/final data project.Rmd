---
title: "FinalDataProject"
author: "Jack Crum"
date: "April 11, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
getwd()
df <- read.csv("AmesHousing.csv")
```

```{r}
names(df) <- tolower(names(df))
# drop the order vairiable
names(df)
```



```{r}
library(VIF)
library(ggplot2)
library(glmnet)
library(caret)
library(tidyverse)
library(gdata)
library(stringr)
library(lubridate)
library(forcats)
```


```{r}
nrow(df)

dim(df)
str(df)
summary(df)
head(df)  

# Are there any missing values in the data
any(is.na(df))
# How many are there
sum(is.na(df))
# return index of columns that have missing values 
na.cols = which(colSums(is.na(df)) > 0)
# Break down missing values by variable
sort(colSums(sapply(df[na.cols], is.na)), decreasing = TRUE)
```

# # Electrical

The electrical variable identifies the electrical system in the sold home. 2677 homes (91.52%) use Standard Circuit Breakers & Romex. Nominal Variable.

```{r}
summary(df$electrical)

```


# # Living Area
Four variables deal with living area:
 - x1st.flr.sf (First Floor Square Feet), Continuous
 - x2nd.flr.sf (Second Floor Square Feet), Continuous
 - low.qual.fin.sf (Low quality finished square feet), Continuous
 - gr.live.area (Above Ground living area square feet), Continuous

As advised in the documentation for the originial project, I have dropped all houses with an above ground living area greater than 4000 square feet, dropping a total of 5 variables. Three of them are true outliers (Partial Sales that likely don't represent actual market values) and two of them are simply unusual sales (very large houses priced relatively appropriately). 

# # First Floor Square Feet

Continuous Variable, ranging from 334 to 3820, median = 1082, mean = 1155, not normally distributed

```{r}
summary(df$x1st.flr.sf)
hist(df$x1st.flr.sf)
shapiro.test(df$x1st.flr.sf)
```

# # Second Floor Square Feet

Continuous variable, ranging from 0 to 1862, median = 0, mean = 333.8, indicating that most homes sold in Ames, Iowa do not have second floors. I made a new variable called has.2nd.floor, which is a dummy variable where 0 = "no second floor" and 1 = "has second floor". 42.67% of homes sold in Ames have 2nd floors.

Made a table containing neighborhoods and the ratio of houses sold that had a second floor in each neighbordhood


```{r} 
summary(df$x2nd.flr.sf)
df$has.2nd.floor <- ifelse(df$x2nd.flr.sf > 0, 1, 0)
df$has.2nd.floor <- as.factor(df$has.2nd.floor)
summary(df$has.2nd.floor)
a <- df %>% filter(has.2nd.floor == 1)
nrow(a) / nrow(df)

tall.houses <- df %>% group_by(neighborhood) %>% summarise(floors = mean(as.numeric(has.2nd.floor)))

head(tall.houses)

```

# # Low Quality Finish Square Feet

Continuous variable, ranging from 0 to 1064, median = 0, mean = 4.685, no missing values

98.63%(2885/2925) of homes have 0 square feet of low quality finish.

OldTown(10), IDOTRR(7), and SWISU(6) have the most homes with low quality finish, though there are not that many(40) total. 

```{r}


summary(df$low.qual.fin.sf)
no.low.qual <- df %>% filter(low.qual.fin.sf == 0)
nrow(no.low.qual) / nrow(df)
wherelow <- df %>% group_by(neighborhood) %>% filter(low.qual.fin.sf > 0) %>% summarise(n = n())
wherelow
```


# # Greater Living Area

Continuous Variable, ranging from 334 to 3820, same as 1st floor square feet, median = 1441, mean = 1494
As suspected, greater living area and sales price are highly correlated and linearly related

Table and graph show median above ground living areas by neighborhood

```{r}
summary(df$gr.liv.area)
cor.test(df$gr.liv.area, df$saleprice)
d <- df %>% group_by(neighborhood) %>% summarise(median_living_area = median(gr.liv.area))
ggplot(d, aes(x = neighborhood, y = median_living_area)) + geom_bar(stat = "identity", fill = "red", col = "black") + coord_flip()
ggplot(df, aes(x = gr.liv.area, y = saleprice)) + geom_point(alpha = 0.2) + geom_smooth(se = FALSE)
```

# # Bathrooms

Four discrete variables relating to bathroom numbers:
  - bsmt.full.bath - number of full baths in the basement
  - bsmt.half.bath - number of half baths in the basement
  - full.bath - number of full baths above ground level
  - half.bath - number of half baths above ground level
  
The majority of homes do not have any half baths or basement full baths. Both bsmt.full.bath and bsmt.half.bath have two missing values. Both are the same two variables, homes 1342 and 1498. 1342 is missing 10 predictors, all related to the basement, giving no indication of whether or not they have a basement. 1498 has no basement as shown by other predictors, so I have given both missing variables a value of 0.  

```{r}
summary(df$bsmt.full.bath)
summary(df$bsmt.half.bath)
summary(df$full.bath)
summary(df$half.bath)

bath.missing <- df %>% filter(is.na(bsmt.half.bath) | is.na(bsmt.full.bath))
bath.missing

df$bsmt.full.bath[which(is.na(df$bsmt.full.bath))] <- 0
df$bsmt.half.bath[which(is.na(df$bsmt.half.bath))] <- 0

```


Decided to combine all bathroom variables (above ground and basement full baths and half baths) into one total bathroom variable, discrete, if we want to simplify our analysis regarding bathrooms.


```{r}
df <- mutate(df, total.bath = bsmt.full.bath + full.bath + (.5 * bsmt.half.bath) + (.5 * half.bath))
summary(df$total.bath)
ggplot(df, aes(x = total.bath, y = saleprice)) + geom_point(alpha = 0.2) 
```

# # Bedrooms

This discrete variable describes the number of bedrooms above ground level, ranging from 0 to 8 with a median of 3 and mean of 2.854.

There are 8 homes with 0 bedrooms above ground level, but those 8 have between 3-6 total above ground rooms.

There is most likely collinearity between number of bedrooms and total number of rooms. A linear model of bedrooms on total rooms returns a p-value of essentially zero.

```{r}
summary(df$bedroom.abvgr)
bedless <- df %>% filter(bedroom.abvgr == 0) 
nrow(bedless)
bedless1 <- subset(bedless, select = c(x, totrms.abvgrd))
bedless1

library(VIF)
test_model <- lm(totrms.abvgrd ~ bedroom.abvgr, data = df)
summary(test_model)
```


# # Kitchen Variables

Two kitchen variables:
  - kitchen.abvgr - number of kitchens above ground level, discrete
  - kitchenqual - kitchen quality, five levels ranging from excellent to poor, ordinal
    - Rearranged the factors of kitchen quality to range from poor to excellent rather than be in              alphabetical order

```{r}
summary(df$kitchen.abvgr)
summary(df$kitchen.qual)

df$kitchen.qual <- factor(df$kitchen.qual, levels = c("Po", "Fa", "TA", "Gd", "Ex"))
levels(df$kitchen.qual)
```

# # Total Rooms Above Ground

Discrete Variable ranging from 2 to 15, no missing values

Graph below compares total rooms above ground with the total 1st and 2nd floor square feet, shows a relatively linear relation,

```{r}
summary(df$totrms.abvgrd)
Rooms.vs.Area <- df %>% mutate(abv.grnd.sf = x1st.flr.sf + x2nd.flr.sf)
ggplot(Rooms.vs.Area, aes(x = totrms.abvgrd, y = abv.grnd.sf)) + geom_jitter(alpha = 0.2)
```

# # Functional

The functional variable is an ordinal variable that describes home functionality and assumes typical unless deductions are warranted. The variable has 8 levels, typical and 7 levels of deductions.

2723 (93.09%) of the homes are typical functionality. 

Rearranged the factors of functional to range from Salvage Only to Typical rather than be in alphabetical order

```{r}
df$functional <- factor(df$functional, levels = c("Sal", "Sev", "Maj2", "Maj1", "Mod", "Min2", "Min1", "Typ"))
summary(df$functional)
```

# # Fireplaces

Two fireplace related variables:
  - fireplaces - number of fireplaces, discrete, no missing values, ranges 0 to 4
  - fireplaces.qu - Ordinal variable that ranges from Na - no fireplace, to Ex - Excellent
    - Reordered the fireplaces.qu factor levels from NA to Excellent
    - 1422 homes are recorded as having no fireplace, but the label is NA
    - 

```{r}
plot(df$fireplaces)
plot(df$fireplace.qu)
```

```{r}
summary(df$fireplaces)
summary(df$fireplace.qu)
```

```{r}
nrow(df[(df$fireplaces > 0) & is.na(df$fireplace.qu), ])

fct_explicit_na(df$fireplace.qu, "None")

levels(df$fireplace.qu)
```

# # Garage Variables

There are seven total variables related to the homes's garage:
  - garage.type - garage location on the home, nominal variable, 
      - six garage levels
      - NA for no garage (157)
  - garage.yr.blt - year the garage was built, discrete (159 NA's)
  - garage.finish - interior finish of the garage, ordinal (157 NA's)
      - three levels: unfinished, rough finished, finished
      - NA for no garage
  - garage.cars - size of the garage in car capacity, discrete (1 NA)
  - garage.area - size of the garage in square feet, continuous (1 NA)
  - garage.qual - quality of the garage, ordinal (158 NA's)
      - five levels from poor to excellent
      - NA for no garage
  - garage.cond - condition of the garage, ordinal (158 NA's)
      - five levels from poor to excellent
      - NA for no garage


```{r}
summary(df$garage.type)
summary(df$garage.yr.blt)
summary(df$garage.finish)
summary(df$garage.cars)
summary(df$garage.area)
summary(df$garage.qual)
summary(df$garage.cond)
```

This code checks the the observations that are missing garage area and garage car capacity values. The code shows that same observation is missing both values, explaining those NA's, as well all garage values except for garage.type. 

```{r}
df[is.na(df$garage.area), ]
df[is.na(df$garage.cars), ]
```
Observation 2237 is responsible for both of these missing values, but has a value for garage.type.

Testing to see if any garage types that are NA have an area > 0 or cars > 0 to show that the NA is a missing value. The result is 0 observations that match this test. We can assume then that there are 157 homes without garages and each ordinal or nominal variable should have 157 NA's.
```{r}
df[(is.na(df$garage.type) & df$garage.area > 0) | (is.na(df$garage.type) & df$garage.cars > 0) , ]
```

After examining the rest of the garage variables, garage.finish is not missing any observations, garage.qual and garage.cond are both are missing one observation, and garage.yr.blt is missing 2 observations, one of which observations is missing all values. The value is observation 1357, which is missing garage.yr.blt, garage.finish, garage.qual, and garage.cond but has values for garage.type, garage.cars, and garage.area.
```{r}
df[(is.na(df$garage.yr.blt) & df$garage.area > 0) | (is.na(df$garage.yr.blt) & df$garage.cars > 0) , ]
df[(is.na(df$garage.finish) & df$garage.area > 0) | (is.na(df$garage.finish) & df$garage.cars > 0) , ]
df[(is.na(df$garage.qual) & df$garage.area > 0) | (is.na(df$garage.qual) & df$garage.cars > 0) , ]
df[(is.na(df$garage.cond) & df$garage.area > 0) | (is.na(df$garage.cond) & df$garage.cars > 0) , ]
```

```{r}
addNA(df$garage.qual) 
summary(df$garage.qual)
df$garage.qual <- factor(df$garage.qual, levels = c("Po", "Fa", "TA", "Gd", "Ex"))
levels(df$garage.qual)
```




```{r}
subset <- subset(df, select = electrical:garage.cond)
salesprice <- df$saleprice
subset_3 <- cbind(subset, salesprice)
subset_3$saleprice <- subset_3$`df$salesprice`
summary(subset_3)

str(subset_3)

# Are there any missing values in the data
any(is.na(subset_3))
# How many are there
sum(is.na(subset_3))
# return index of columns that have missing values 
na.cols = which(colSums(is.na(subset_3)) > 0)
# Break down missing values by variable
sort(colSums(sapply(subset_3[na.cols], is.na)), decreasing = TRUE)
```






```{r}
model <- glm(salesprice ~ ., data = subset_3)
summary(model)
```

